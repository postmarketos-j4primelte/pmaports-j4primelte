# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Luca Weiss <luca@z3ntu.xyz>
pkgname=lomiri-download-manager
pkgver=0_git20200303
_commit="84a11f542c07286d865eb4bc6d4a53e4dc872ed1"
pkgrel=0
pkgdesc="Provides a service for downloading files while an application is suspended"
arch="all"
url="https://gitlab.com/ubports/core/lomiri-download-manager"
license="LGPL-3.0"
depends_dev="qt5-qtdeclarative-dev boost-dev glog-dev libnih-dev"
makedepends="$depends_dev cmake cmake-extras gtest-dev gmock"
checkdepends="dbus-test-runner xvfb-run"
source="https://gitlab.com/ubports/core/lomiri-download-manager/-/archive/$_commit/lomiri-download-manager-$_commit.tar.gz"
subpackages="$pkgname-dev"
builddir="$srcdir/$pkgname-$_commit"
options="!check" # Tests fail

build() {
	mkdir -p "$builddir"/build
	cd "$builddir"/build
	cmake \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBEXECDIR=/usr/lib \
		-DCMAKE_INSTALL_LIBDIR=lib ..
	make
}

check() {
	cd "$builddir"/build
	make test
}

package() {
	cd "$builddir"/build
	make DESTDIR="$pkgdir" install
}

sha512sums="21e283e05c36712282c4f42cf4e1382c059f707638d874518f5cf03bbdc3d22a307ade595c2c13af53d70e18c8ec588f174505779e0db28ba2152e1ee9fe0dd4  lomiri-download-manager-84a11f542c07286d865eb4bc6d4a53e4dc872ed1.tar.gz"
