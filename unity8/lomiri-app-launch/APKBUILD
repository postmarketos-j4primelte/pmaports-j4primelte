# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Luca Weiss <luca@z3ntu.xyz>
pkgname=lomiri-app-launch
pkgver=0_git20200306
pkgrel=0
_commit="98b9d4c04caf5f748ab896b9de04960dc643facd"
pkgdesc="Session init system job for Launching Applications"
arch="all"
url="https://gitlab.com/ubports/core/lomiri-app-launch"
license="GPL-3.0"
depends_dev="gobject-introspection-dev lttng-ust-dev json-glib-dev zeitgeist-dev lomiri-api-dev curl-dev properties-cpp-dev"
makedepends="$depends_dev cmake cmake-extras dbus-test-runner qt5-qtdeclarative gtest-dev glib-dev mir-dev"
checkdepends="gtest-dev gmock py3-dbusmock"
source="https://gitlab.com/ubports/core/lomiri-app-launch/-/archive/$_commit/lomiri-app-launch-$_commit.tar.gz
	libual-test_libertine.patch"
subpackages="$pkgname-dev"
builddir="$srcdir/$pkgname-$_commit"
options="!check" # Tests have to be adjusted for POSIX backend

prepare() {
	default_prepare

	# Don't build tests, see above
	truncate -s 0 "$builddir"/tests/CMakeLists.txt
}

build() {
	cmake \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib
	make
}

check() {
	cd "$builddir"
	make test
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
}

sha512sums="8d03175ffcb7613445b71b0825fc7d6d65fe62cf1fd0ace68166992ee5542b9cafc824b9c1a1a65ed267fbe7579caa82afe24958c74bc518cbab12e91b90340f  lomiri-app-launch-98b9d4c04caf5f748ab896b9de04960dc643facd.tar.gz
d7338b9f514398b685328cfd81bcd9f7d9b11149674831bb065f3d1074ff1602009e0fe08bbed0855657084c8a48f88b9b1228d8a496095ffcc185d4f3f35a6b  libual-test_libertine.patch"
