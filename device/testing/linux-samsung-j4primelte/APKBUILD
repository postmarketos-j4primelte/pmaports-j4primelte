# Contributor: Ataberk Ã–zen <ataberkozen123@gmail.com>
# Maintainer: Camden B <camden.o.b@gmail.com>
# Reference: <https://postmarketos.org/vendorkernel>
# Kernel config based on: /arch/arm64/configs/defconfig

pkgname="linux-samsung-j4primelte"
pkgver=5.8.0
pkgrel=0
pkgdesc="Samsung Galaxy J4+ mainline kernel fork"
arch="aarch64"
_carch="arm64"
_flavor="samsung-j4primelte"
url="https://kernel.org"
license="GPL-2.0-only"
options="!strip !check !tracedeps pmb:cross-native"
makedepends="bison findutils flex installkernel openssl-dev perl"

# Source
_repository="linux"
_commit="a93072033ec3dbba6566870e4d31462ffe7d2f9d"
_config="config-$_flavor.$arch"
source="
	$pkgname-$_commit.tar.gz::https://github.com/postmarketos-j4primelte/$_repository/archive/$_commit.tar.gz
	$_config
"
builddir="$srcdir/$_repository-$_commit"

prepare() {
	default_prepare
	cp "$srcdir/config-$_flavor.$arch" .config
}

build() {
	unset LDFLAGS
	make ARCH="$_carch" CC="${CC:-gcc}" \
		KBUILD_BUILD_VERSION="$((pkgrel + 1 ))-postmarketOS"
}

package() {
	mkdir -p "$pkgdir"/boot
	install -Dm644 "$builddir/arch/$_carch/boot/Image.gz" \
		"$pkgdir/boot/vmlinuz-$_flavor"

	install -D "$builddir/include/config/kernel.release" \
		"$pkgdir/usr/share/kernel/$_flavor/kernel.release"

	make modules_install dtbs_install \
		ARCH="$_carch" \
		INSTALL_MOD_PATH="$pkgdir" \
		INSTALL_DTBS_PATH="$pkgdir"/usr/share/dtb

sha512sums="08439e0506dbb4e2a1dd4ffd0f5353285ffe08fd31400c1a4c37817bb702de49b804695a8de221412cf9546ceea6738f5c0a2b23ec103c59fdc506d80a349ada  linux-samsung-j4primelte-a93072033ec3dbba6566870e4d31462ffe7d2f9d.tar.gz
79651e2aced3e6a6e4de2219f324394a7ac3278c9f5ea3991ad9d615b5817c822a93c4f27c070172b9700e7e05f05f8de88156cfeeb13cb605672016a3757593  config-samsung-j4primelte.aarch64"
