# Contributor: Ataberk Ã–zen <ataberkozen123@gmail.com>
# Maintainer: Camden B <camden.o.b@gmail.com>
# Reference: <https://postmarketos.org/vendorkernel>
# Kernel config based on: /arch/arm64/configs/defconfig

pkgname="linux-samsung-j4primelte"
pkgver=5.8.0
pkgrel=0
pkgdesc="Samsung Galaxy J4+ mainline kernel fork"
arch="aarch64"
_carch="arm64"
_flavor="samsung-j4primelte"
url="https://kernel.org"
license="GPL-2.0-only"
options="!strip !check !tracedeps"
makedepends="bash bc bison devicepkg-dev flex openssl-dev perl gcc4"

# Compiler: GCC 4 (doesn't boot when compiled with newer versions)
if [ "${CC:0:5}" != "gcc4-" ]; then
	CC="gcc4-$CC"
	HOSTCC="gcc4-gcc"
	CROSS_COMPILE="gcc4-$CROSS_COMPILE"
fi

# Source
_repository="linux"
_commit="a93072033ec3dbba6566870e4d31462ffe7d2f9d"
_config="config-$_flavor.$arch"
source="
	$pkgname-$_commit.tar.gz::https://github.com/postmarketos-j4primelte/$_repository/archive/$_commit.tar.gz
	$_config
"
builddir="$srcdir/$_repository-$_commit"
_outdir="out"

prepare() {
	default_prepare
	mkdir "$builddir/$_outdir"
	cp "$srcdir/config-$_flavor.$arch" "$_outdir"/.config
}

build() {
	unset LDFLAGS
	make O="$_outdir" ARCH="$_carch" CC="${CC:-gcc}" \
		KBUILD_BUILD_VERSION="$((pkgrel + 1 ))-postmarketOS"
}

package() {
	"$builddir" "$pkgdir" "$_carch" "$_flavor" "$_outdir"
}

sha512sums="08439e0506dbb4e2a1dd4ffd0f5353285ffe08fd31400c1a4c37817bb702de49b804695a8de221412cf9546ceea6738f5c0a2b23ec103c59fdc506d80a349ada  linux-samsung-j4primelte-a93072033ec3dbba6566870e4d31462ffe7d2f9d.tar.gz
255aac431b1f4c2f7239995e9fbb7a0711e9690ff7fd5921cf16307c745f79c21cf1467ef1e11e2bef5bed56eb8b54b59f148194f39a7fa49a1daf2164c9e79f  config-samsung-j4primelte.aarch64"
